⚠️ AVERTISSEMENT STRICT
Techniques de malware development. Usage éducatif uniquement.

EXERCICES - MODULE 36 : MEMORY MAPPING

[ ] 1. FILELESS SHELLCODE EXECUTION
Exécuter shellcode sans fichier disque :
- mmap() anonymous avec PROT_EXEC
- Download shellcode depuis socket
- Copy to RWX memory
- Cast to function pointer et execute
- munmap cleanup

Référence : Metasploit fileless stagers

[ ] 2. SHARED MEMORY C2 IPC
Communication C2 via shared memory :
- shm_open() / CreateFileMapping named
- Process A (implant) write beacons
- Process B (handler) read commands
- Mutex synchronization
- Delete on exit (shm_unlink)

Référence : Advanced IPC techniques

[ ] 3. MEMORY-MAPPED PE LOADER
Charger PE/ELF depuis memory mapping :
- Map PE file in memory
- Parse headers (DOS, NT, sections)
- Relocate if needed (fix base address)
- Resolve imports
- Execute entry point

Référence : Reflective DLL injection

[ ] 4. COW (COPY-ON-WRITE) EXPLOITATION
Exploiter MAP_PRIVATE COW :
- mmap() file MAP_PRIVATE
- Fork() child process
- Modify in child (COW triggered)
- Parent sees original
- Race condition exploitation

Référence : Dirty COW vulnerability

[ ] 5. CROSS-PROCESS MEMORY DUMP
Dump autre processus via mapping :
- OpenProcess (Windows) / ptrace (Linux)
- CreateFileMapping on target process
- MapViewOfFile remote memory
- Dump PE headers, .text section
- Extract credentials/keys

Référence : Mimikatz lsass dumping

[ ] 6. ANTI-FORENSICS MEMORY WIPE
Secure wipe mapped memory :
- mmap() puis write sensitive data
- memset() zeros before munmap
- mlock() prevent swapping to disk
- msync(MS_INVALIDATE) clear cache
- Verify no disk artifacts

Référence : Memory forensics evasion

[ ] 7. LARGE FILE PROCESSING
Process 10GB+ files via mapping :
- mmap() file (don't load all in RAM)
- Process by chunks (page-by-page)
- Search/replace patterns
- Memory efficient (lazy loading)
- Performance comparison vs read()

Référence : Big data memory-mapped I/O

[ ] 8. MEMORY PERMISSION JUGGLING
RW -> RX technique (DEP bypass) :
- Allocate RW (mmap PROT_READ|PROT_WRITE)
- Write shellcode
- mprotect() change to RX
- Execute (DEP not triggered)
- Compare vs direct RWX allocation

Référence : DEP bypass techniques

NOTES :
- RWX pages = highly suspicious
- /proc/[pid]/maps shows all mappings (Linux)
- Process Explorer shows memory regions (Windows)
- Sysmon Event ID 10 detects suspicious access
- DEP/NX blocks RWX, force RW->RX juggling
