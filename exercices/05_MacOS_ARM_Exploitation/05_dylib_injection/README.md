# Dylib Injection (macOS)

Injecter du code dans des processus via bibliothèques dynamiques.

## Créer une Dylib

```c
__attribute__((constructor))
void on_load() {
    printf("[+] Injected!\n");
}
```

```bash
clang -dynamiclib -o inject.dylib inject.c
```

## Injection

### Méthode 1 : DYLD_INSERT_LIBRARIES

```bash
DYLD_INSERT_LIBRARIES=./inject.dylib ./target
```

### Méthode 2 : Modifier Mach-O

```bash
insert_dylib --inplace ./inject.dylib binary
./binary
```

## Hooking

```c
static void* (*real_malloc)(size_t) = NULL;

void* malloc(size_t size) {
    if (!real_malloc)
        real_malloc = dlsym(RTLD_NEXT, "malloc");
    
    void *ptr = real_malloc(size);
    printf("[malloc] %zu → %p\n", size, ptr);
    return ptr;
}
```

## Protection

- **SIP** : Bloque injection dans processus système
- **Hardened Runtime** : Désactive DYLD env vars
- **Code Signing** : Dylibs doivent être signées

## Compilation

```bash
clang -dynamiclib -o inject.dylib example.c
DYLD_INSERT_LIBRARIES=./inject.dylib /bin/ls
```

