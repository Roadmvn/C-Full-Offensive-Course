# Cours : ROP Chains - Return-Oriented Programming

## 1. Introduction

**ROP** = Réutiliser des morceaux de code existants pour bypasser DEP/NX.

## 2. Le Problème DEP

```ascii
DEP (Data Execution Prevention) :

Mémoire SOIT :
- RW (Read+Write) mais PAS exécutable
- RX (Read+Execute) mais PAS writable

Stack :  RW  ❌ Shellcode ne peut pas s'exécuter
Code :   RX  ✅ Mais on ne peut pas y écrire
```

## 3. Gadgets ROP

```ascii
GADGET = Séquence d'instructions se terminant par RET

Exemple dans libc :
0x400123: pop rdi ; ret
0x400456: pop rsi ; ret
0x400789: syscall ; ret

ROP CHAIN (sur la stack) :
┌──────────────┐
│ 0x400123     │  pop rdi ; ret
├──────────────┤
│ 0xDEADBEEF   │  Valeur pour RDI
├──────────────┤
│ 0x400456     │  pop rsi ; ret
├──────────────┤
│ 0xCAFEBABE   │  Valeur pour RSI
├──────────────┤
│ 0x400789     │  syscall ; ret
└──────────────┘

Exécution :
1. ret → 0x400123 (pop rdi)
2. RDI = 0xDEADBEEF
3. ret → 0x400456 (pop rsi)
4. RSI = 0xCAFEBABE
5. ret → 0x400789 (syscall)
6. Syscall exécuté !
```

## Ressources

- [ROP Explained](https://en.wikipedia.org/wiki/Return-oriented_programming)
- [ROPgadget](https://github.com/JonathanSalwan/ROPgadget)

