⚠️ AVERTISSEMENT STRICT
Techniques de malware development. Usage éducatif uniquement.

EXERCICES - MODULE 30 : ANTI-DEBUGGING

[ ] 1. PEB ANTI-DEBUG COMPLET
Implémenter tous checks PEB :
- BeingDebugged flag
- NtGlobalFlag (0x70 si débogué)
- HeapFlags manipulation
- ProcessHeap Flags/ForceFlags
- Accès direct via gs:[0x60] (x64)

Référence : PEB structure documentation

[ ] 2. TIMING CHECKS AVANCÉS
Multiples techniques timing :
- RDTSC before/after operations
- QueryPerformanceCounter comparaison
- GetTickCount vs timeGetTime
- Sleep() timing deviation
- Comparer exécution normale vs débogué

Référence : Timing attack anti-debug

[ ] 3. NTQUERYINFORMATIONPROCESS CHECKS
Tous les ProcessInformationClass :
- ProcessDebugPort (7)
- ProcessDebugObjectHandle (30)
- ProcessDebugFlags (31)
- ProcessBasicInformation
- Détecter hidden debuggers

Référence : MSDN NtQueryInformationProcess

[ ] 4. HARDWARE BREAKPOINTS DETECTION
Debug registers DR0-DR7 :
- DR0-DR3 : breakpoint addresses
- DR6 : status register
- DR7 : control register (enabled flags)
- GetThreadContext pour lire
- Détecter et clear si présents

Référence : Intel x86/x64 debug registers

[ ] 5. INT 2D / INT3 DETECTION
Interrupt-based detection :
- INT 2D (kernel debugger check)
- INT 3 (0xCC) software breakpoint
- SEH exception handling
- Détecter si exception interceptée par debugger

Référence : Windows exception handling

[ ] 6. LINUX ANTI-DEBUG (PTRACE)
Techniques Linux complètes :
- ptrace(PTRACE_TRACEME) check
- /proc/self/status TracerPid
- LD_PRELOAD detection
- Breakpoint via SIGTRAP
- Parent process name check (gdb, lldb)

Référence : Linux ptrace man page

[ ] 7. SCYLLAHIDE DETECTION
Détecter bypass plugins :
- ScyllaHide signatures en mémoire
- Hooks sur IsDebuggerPresent
- PEB patching detection
- TitanHide kernel driver presence

Référence : Anti-anti-debug techniques

[ ] 8. MULTI-LAYER PROTECTION
Combiner toutes techniques :
- 10+ checks différents
- Randomiser ordre checks
- Delayed checks (timer-based)
- Checksums anti-patch
- Code integrity verification

Référence : Themida/VMProtect multi-layer

NOTES :
- Anti-debug peut être bypassé (patch, hooks, plugins)
- Kernel debugging bypass userland checks
- Combiner avec obfuscation pour efficacité
- Timing checks moins fiables sur VMs
- Tester avec x64dbg, IDA Pro, GDB
